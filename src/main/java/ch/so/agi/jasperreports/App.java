package ch.so.agi.jasperreports;

import java.io.File;
import java.io.IOException;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLConnection;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;
import java.nio.file.StandardCopyOption;



public class App {

    public static void main(String[] args) throws UnsupportedOperationException, IOException {

        
        URL url = new URL("http://geo.dev.so.ch/wms?");
        URLConnection con = url.openConnection();
        HttpURLConnection http = (HttpURLConnection)con;
        http.setRequestMethod("POST"); 
        http.setDoOutput(true);

        //String params = "LAYERS=ch.so.arp.aggloprogramme.uebersicht&FORMAT=image%2Fpng&TRANSPARENT=TRUE&DPI=96&VERSION=1.3.0&EXCEPTIONS=INIMAGE&SERVICE=WMS&REQUEST=GetMap&STYLES=&CRS=EPSG%3A2056&WIDTH=1870&HEIGHT=709&BBOX=2592747.333333333,1227423.25,2632329,1242430.4166666665";
        String params = "LAYERS=ch.so.arp.aggloprogramme.uebersicht&FORMAT=image%2Fpng&TRANSPARENT=TRUE&DPI=96&VERSION=1.3.0&EXCEPTIONS=INIMAGE&SERVICE=WMS&REQUEST=GetMap&STYLES=&CRS=EPSG%3A2056&HIGHLIGHT_GEOM=MULTIPOLYGON(((2622020.08783357 1239824.61559504,2622113.70808358 1239935.09407111,2622159.95020178 1239990.17430625,2622208.92135906 1240046.49555526,2622288.72145714 1240079.42796055,2622339.51298661 1240087.73221841,2622407.16382094 1240108.43756194,2622468.70099198 1240158.05487467,2622530.41316348 1240207.60018829,2622589.82729655 1240255.68749024,2622653.41350725 1240307.00781339,2622714.42667019 1240356.34312346,2622771.64799279 1240419.9374144,2622828.84331913 1240483.82770522,2622885.25263491 1240547.41199204,2622942.46497164 1240612.06728294,2622932.97692588 1240689.18523542,2622923.58486466 1240765.08918837,2622914.07180585 1240841.24714071,2622935.59650176 1240908.48702608,2622980.19796956 1241041.92368075,2623049.73066102 1241074.2966405,2623122.59442959 1241108.93557783,2623193.50014805 1241143.0995614,2623228.03785898 1241182.78895015,2623251.82135627 1241208.69716339,2623272.27463876 1241245.84821924,2623457.61450017 1241656.38928241,2623454.96541474 1241660.48433889,2623451.24322507 1241669.67745285,2623473.43219326 1241672.28235119,2623512.45490358 1241688.40628856,2623571.66797308 1241687.73394055,2623574.51596321 1241688.35393038,2623623.56933654 1241701.23505663,2623655.39490244 1241697.85020019,2623722.57365927 1241724.18060216,2623739.85234309 1241730.58770448,2623946.97160397 1241802.16991546,2624105.15881191 1241747.90051832,2624535.84844457 1241854.97591297,2624566.28293032 1241861.89108026,2624585.9705879 1241867.36419144,2624610.91312684 1241877.08734054,2624645.90953893 1241884.68853187,2624676.53006095 1241887.60968825,2624731.48401781 1241911.83102501,2624768.96940647 1241918.09022438,2624804.69772094 1241934.58844555,2624849.59287246 1241953.99571954,2624864.89366959 1241951.77078679,2624891.35347491 1241931.93185582,2624913.24425468 1241921.57793085,2624918.60618031 1241921.13395541,2624938.49789929 1241920.01204807,2624990.16595978 1241938.56035221,2625011.78645831 1241960.96050246,2625031.09539828 1241974.42542747,2625041.36832759 1241990.16938655,2625070.41123372 1242011.21527366,2625082.2641781 1242023.63622713,2625097.6231293 1242034.58016746,2625143.55802928 1242057.13899018,2625174.06900177 1242063.50687346,2625198.62610301 1242041.31478277,2625223.78320053 1242019.9516897,2625295.41103014 1242058.32441289,2625372.78678104 1242114.17511216,2625392.90570858 1242130.39903376,2625416.00361243 1242151.89594341,2625420.1536601 1242141.37892889,2625413.89271627 1242128.88595418,2625426.00283277 1242103.2029112,2625438.33084889 1242099.74686476,2625451.84396582 1242073.98181647,2625448.80803279 1242059.12582978,2625450.57810769 1242042.56082502,2625458.78617098 1242028.62179548,2625461.10019388 1242023.57378729,2625489.64137422 1241983.90568353,2625478.81749057 1241958.04772775,2625469.4895721 1241939.91276536,2625466.72761946 1241929.40277711,2625467.20681523 1241886.06578045,2625466.98692837 1241861.01378427,2625458.83723842 1241792.29782342,2625487.80281243 1241665.47672843,2625510.17520977 1241577.71065385,2625529.54141574 1241532.28558565,2625575.13101143 1241400.81642803,2625591.83836138 1241323.49137373,2625682.34938613 1241097.43605664,2625729.24333401 1241109.39987699,2625839.43675977 1240951.08904684,2625841.67375352 1240948.02207789,2625987.23534824 1240738.80617989,2625989.48534198 1240735.58221229,2625997.76331892 1240723.7233315,2626001.22130932 1240718.61538261,2626109.89300667 1240562.85994816,2626218.88670318 1240406.39452047,2626227.57267891 1240394.38564184,2626139.87098154 1240334.65291779,2626089.4613868 1240300.33268597,2626014.60198912 1240249.24234196,2625943.10256523 1240200.24201379,2625893.92296104 1240166.65178784,2625893.20219853 1240166.12861972,2625890.91991501 1240164.45901719,2625888.6471147 1240162.77652803,2625886.38387038 1240161.08120609,2625884.1302545 1240159.37310565,2625881.8863392 1240157.6522814,2625879.65219632 1240155.91878841,2625877.42789739 1240154.17268219,2625875.21351361 1240152.41401864,2625873.00911588 1240150.64285407,2625870.81477477 1240148.85924516,2625868.63056052 1240147.06324904,2625866.45654307 1240145.25492318,2625864.29279201 1240143.43432548,2625862.13937661 1240141.60151423,2625859.99636582 1240139.75654811,2625857.86382823 1240137.89948617,2625855.74183213 1240136.03038788,2625853.63044544 1240134.14931306,2625851.52973576 1240132.25632195,2625849.43977034 1240130.35147513,2625847.36061609 1240128.4348336,2625845.29233957 1240126.50645871,2625843.235007 1240124.5664122,2625841.18868423 1240122.61475617,2625839.15343679 1240120.65155311,2625838.05207247 1240119.5729753,2625836.04029863 1240117.58552286,2625834.03980152 1240115.58672,2625832.05064519 1240113.57663072,2625830.07289331 1240111.55531936,2625828.10660919 1240109.52285062,2625826.15185577 1240107.47928957,2625824.20869563 1240105.42470161,2625822.27719097 1240103.35915252,2625820.35740362 1240101.28270842,2625818.44939503 1240099.19543578,2625816.55322628 1240097.09740141,2625814.66895807 1240094.98867247,2625812.79665071 1240092.86931647,2625810.93636415 1240090.73940125,2625809.08815792 1240088.59899499,2625807.25209119 1240086.4481662,2625805.42822273 1240084.28698373,2625803.61661094 1240082.11551677,2625801.8173138 1240079.93383484,2625800.0303889 1240077.74200775,2625798.25589345 1240075.54010568,2625796.49388426 1240073.32819911,2625794.74441772 1240071.10635885,2625793.00754983 1240068.87465602,2625791.28333621 1240066.63316205,2625789.57183203 1240064.3819487,2625787.87309209 1240062.12108804,2625786.18717076 1240059.85065244,2625784.51412201 1240057.57071458,2625782.85399941 1240055.28134742,2625781.36159252 1240053.20829493,2625779.72131352 1240050.90378093,2625778.09409582 1240048.5900258,2625776.4799915 1240046.26710356,2625774.87905221 1240043.93508855,2625773.29132914 1240041.59405536,2625771.71687312 1240039.2440789,2625770.15573451 1240036.88523437,2625768.60796326 1240034.51759721,2625767.07360889 1240032.1412432,2625765.55272049 1240029.75624836,2625764.04534672 1240027.36268899,2625762.55153581 1240024.96064168,2625761.07133555 1240022.55018328,2625759.60479331 1240020.1313909,2625758.15195599 1240017.70434195,2625756.71287009 1240015.26911407,2625755.28758165 1240012.82578517,2625753.87613627 1240010.37443343,2625752.47857911 1240007.91513727,2625751.09495487 1240005.44797539,2625749.72530784 1240002.97302672,2625748.36968183 1240000.49037044,2625747.02812022 1239998.00008598,2625745.70066592 1239995.50225302,2625744.38736141 1239992.99695148,2625743.0882487 1239990.48426151,2625741.80336937 1239987.9642635,2625740.53276452 1239985.43703809,2625739.2764748 1239982.90266612,2625738.03454039 1239980.3612287,2625746.12454288 1239969.27129856,2625750.76454488 1239962.77133891,2625792.32455958 1239905.32969875,2625874.35459027 1239791.5424098,2625878.98459167 1239785.20244978,2625780.97531634 1239734.02196847,2625789.49531937 1239722.24204224,2625794.2043207 1239715.81808285,2625903.61543433 1239550.81311601,2625960.94499211 1239580.62333908,2625987.0338003 1239593.98046772,2625987.376801 1239593.36447097,2626141.11234842 1239317.19500278,2626114.02865377 1239303.41520108,2625899.06108266 1239193.70678797,2625893.58107411 1239195.37665672,2625889.80111699 1239193.43668504,2625895.57126405 1239182.92715965,2625967.73308245 1239052.80304483,2625972.79321051 1239043.64345885,2626044.93503482 1238913.149358,2626068.14562166 1238871.17125572,2626066.55572321 1238865.06147113,2626037.5861033 1238846.93181357,2625971.03697853 1238805.15260529,2625935.42844641 1238782.82502788,2625842.05767327 1238724.27813597,2625827.17386775 1238715.01430996,2625741.73668327 1238871.07726521,2625718.08799858 1238919.34812023,2625713.33889607 1238926.82377474,2625654.46362418 1239019.56948903,2625646.75046785 1239031.06695267,2625573.82190057 1239145.43066397,2625566.67674654 1239156.66514466,2625565.0858596 1239149.82638809,2625380.39816377 1239041.78928125,2625323.4097848 1239014.15564618,2625278.56404533 1239006.87337737,2625208.61835099 1239128.67683917,2625012.7764611 1239016.58653349,2624983.36493804 1238999.79516403,2624633.10369809 1238798.93278005,2624623.9915463 1238794.57665056,2624311.57497904 1238615.29174248,2624135.70484815 1238514.62353791,2624119.60656246 1238505.48233482,2624099.88078123 1238541.17425357,2624087.12246843 1238533.9830157,2624074.07576609 1238526.64739521,2624061.0212297 1238519.32572515,2624047.95887417 1238512.01801388,2624034.88871444 1238504.72426976,2624021.81076544 1238497.44450111,2624008.72504211 1238490.17871627,2623995.63155941 1238482.92692352,2623982.5303323 1238475.68913117,2623969.42137575 1238468.46534747,2623956.30470474 1238461.25558069,2623943.18033426 1238454.05983906,2623930.04827932 1238446.87813081,2623916.90855491 1238439.71046414,2623903.76117605 1238432.55684725,2623890.60615777 1238425.4172883,2623877.44351509 1238418.29179546,2623864.27326307 1238411.18037688,2623851.09542654 1238404.08310843,2623720.55138339 1238334.66387637,2623716.32045557 1238342.37881325,2623612.8692204 1238531.01126988,2623614.69133242 1238537.99223958,2623613.06536166 1238541.06521472,2623654.01001676 1238563.86628176,2623565.14553968 1238726.39995323,2623476.11205627 1238672.57883111,2623467.41611004 1238681.62573936,2623442.67556663 1238729.22335639,2623416.07400999 1238776.97596373,2623415.85216993 1238788.62389769,2623407.59444351 1238813.23572118,2623401.90284609 1238845.60851354,2623401.42398942 1238856.21345209,2623395.00793729 1238856.27842129,2623384.21093742 1238862.71333416,2623358.81184515 1238871.18516638,2623344.80870965 1238869.76210787,2623334.72965395 1238871.75004896,2623315.68663359 1238881.61690355,2623310.74367564 1238887.58584679,2623302.62598351 1238914.58365763,2623261.508187 1238953.70424426,2623259.78514707 1238951.85424641,2623239.95212383 1238961.98409578,2623235.39215147 1238966.6880479,2623216.24067011 1238943.42708683,2623193.4209738 1238906.87318252,2623177.38843744 1238877.79626869,2623175.38905474 1238851.43140631,2623166.93993075 1238847.53238797,2623017.97394906 1238937.50117917,2622829.04190271 1239046.59867401,2622757.41687369 1239087.13410799,2622670.81489536 1239140.23140082,2622584.00315649 1239210.69559575,2622496.24438296 1239279.22679697,2622433.92982681 1239348.26811608,2622397.28406323 1239387.09872554,2622319.52854692 1239469.59111194,2622291.51571534 1239574.10397062,2622247.57974686 1239678.18674847,2622115.47186369 1239768.18607869,2622020.08783357 1239824.61559504)))&HIGHLIGHT_SYMBOL=%3CStyledLayerDescriptor%3E%3CUserStyle%3E%3CName%3EHighlight%3C%2FName%3E%3CFeatureTypeStyle%3E%3CRule%3E%3CName%3ESymbol%3C%2FName%3E%3CPolygonSymbolizer%3E%3CFill%3E%3CSvgParameter+name%3D%22fill%22%3E%230000FF%3C%2FSvgParameter%3E%3CSvgParameter+name%3D%22fill-opacity%22%3E0%3C%2FSvgParameter%3E%3C%2FFill%3E%3CStroke%3E%3CSvgParameter+name%3D%22stroke%22%3E%230000FF%3C%2FSvgParameter%3E%3CSvgParameter+name%3D%22stroke-opacity%22%3E1.0%3C%2FSvgParameter%3E%3CSvgParameter+name%3D%22stroke-width%22%3E10%3C%2FSvgParameter%3E%3C%2FStroke%3E%3C%2FPolygonSymbolizer%3E%3C%2FRule%3E%3C%2FFeatureTypeStyle%3E%3C%2FUserStyle%3E%3C%2FStyledLayerDescriptor%3E&HIGHLIGHT_LABELSTRING=Riedholz%2C+GB-Nr+371&HIGHLIGHT_LABELFONT=CadastraCondensed&HIGHLIGHT_LABELSIZE=10&HIGHLIGHT_LABELCOLOR=%230000FF&HIGHLIGHT_LABELBUFFERCOLOR=%23FFFFFF&HIGHLIGHT_LABELBUFFERSIZE=1&WIDTH=1870&HEIGHT=709&BBOX=2592747.333333333,1227423.25,2632329,1242430.4166666665";
        byte[] out = params.getBytes(StandardCharsets.UTF_8);
        int length = out.length;
        
        http.setFixedLengthStreamingMode(length);
        http.setRequestProperty("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
        http.connect();
        try(OutputStream os = http.getOutputStream()) {
            os.write(out);
        }
        // Do something with http.getInputStream()
        http.getInputStream();
//        byte[] targetArray = new byte[http.getInputStream().available()];
//        http.getInputStream().read(targetArray);

        File targetFile = new File("/Users/stefan/tmp/fubar.png");
        
        java.nio.file.Files.copy(http.getInputStream(), targetFile.toPath(), StandardCopyOption.REPLACE_EXISTING);
        http.disconnect();

        

        System.out.println("Fubar");

    }

}
